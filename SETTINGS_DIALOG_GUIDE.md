# Руководство по диалогу настроек

## Обзор

В проекте реализована система диалога настроек, аналогичная той, что используется в `auto-exec-doc`. Система включает в себя:

- Менеджер настроек с использованием QSettings
- Диалоговое окно настроек с современным интерфейсом
- Интеграцию с существующей системой смены тем
- Перемещение выбора стиля из меню в диалог настроек

## Структура системы

### Файлы

- `package/modules/settings.py` - менеджер настроек
- `package/components/settingsdialog.py` - диалоговое окно настроек
- Обновления в `package/app.py` и `package/components/mainwindow.py`

### Менеджер настроек (Settings)

Класс `Settings` предоставляет следующие возможности:

#### Основные методы

```python
# Инициализация
settings = Settings()
settings.setting_osbm(osbm)
settings.initialize_default_settings()

# Работа с темами
settings.get_theme()  # возвращает "dark" или "light"
settings.get_theme_display_name()  # возвращает "Тёмная" или "Светлая"
settings.set_theme(theme)  # устанавливает тему
settings.set_theme_by_display_name(display_name)  # устанавливает по русскому названию

# Работа с настройками
settings.get_show_parameters()  # отображение параметров
settings.set_show_parameters(show)

# Работа с проектами
settings.add_or_update_project(project_dir)
settings.get_projects()
settings.get_last_projects(limit=5)
settings.delete_project(project_dir)

# Синхронизация
settings.sync()
```

#### Настройки по умолчанию

- `theme`: "dark" (темная тема)
- `show_parameters`: True (отображать параметры)
- `project_current_name`: "" (имя текущего проекта)
- `projects`: [] (список проектов)

### Диалог настроек (SettingsDialog)

Диалоговое окно предоставляет удобный интерфейс для управления настройками:

#### Интерфейс

1. **Тема приложения**
   - Выпадающий список с темами ("Тёмная", "Светлая")
   - Кнопка "Сброс" для возврата к значению по умолчанию

2. **Отображение параметров**
   - Чекбокс "Отображать панель параметров"
   - Кнопка "Сброс" для возврата к значению по умолчанию

3. **Сброс всех настроек**
   - Кнопка для сброса всех настроек к значениям по умолчанию

4. **Кнопки управления**
   - "Сохранить" (Ctrl+S) - сохраняет настройки
   - "Отмена" (Ctrl+Q) - закрывает диалог без сохранения

#### Функциональность

- **Валидация**: Проверка корректности введенных значений
- **Автоматическое применение**: Тема применяется сразу при сохранении
- **Сброс настроек**: Возможность сброса отдельных или всех настроек
- **Горячие клавиши**: Поддержка клавиатурных сокращений

## Интеграция с приложением

### В главном приложении

1. **Инициализация**: Менеджер настроек создается в `ObjectsManager`
2. **Загрузка темы**: При запуске загружается сохраненная тема
3. **Доступ к настройкам**: Через `self.__obsm.obj_settings`

### В главном окне

1. **Меню**: Добавлено действие "Параметры" в меню "Прочее"
2. **Убрано подменю тем**: Выбор темы перенесен в диалог настроек
3. **Метод открытия**: `_open_settings()` для открытия диалога

### Изменения в UI

- Добавлено действие `action_settings` с иконкой настроек
- Убрано подменю "Тема" из меню
- Добавлен текст "Параметры" для нового действия

## Использование

### Открытие диалога настроек

```python
# В главном окне
self.ui.action_settings.triggered.connect(self._open_settings)

def _open_settings(self):
    dialog = settingsdialog.SettingsDialog(self.__obsm)
    result = dialog.exec()
    if result == QDialog.Accepted:
        # Настройки были сохранены
        pass
```

### Работа с настройками в коде

```python
# Получение настроек
theme = self.__obsm.obj_settings.get_theme()
show_params = self.__obsm.obj_settings.get_show_parameters()

# Установка настроек
self.__obsm.obj_settings.set_theme("light")
self.__obsm.obj_settings.set_show_parameters(False)
self.__obsm.obj_settings.sync()
```

### Добавление новых настроек

1. **В менеджере настроек** (`settings.py`):
   ```python
   def get_new_setting(self) -> str:
       return self.__settings.value("new_setting", "default_value")
   
   def set_new_setting(self, value: str):
       self.__settings.setValue("new_setting", value)
   ```

2. **В диалоге настроек** (`settingsdialog.py`):
   - Добавить элементы управления в `config_ui()`
   - Добавить загрузку в `load_settings()`
   - Добавить сохранение в `save_settings()`
   - Добавить сброс в `reset_all_settings()`

## Совместимость

Система полностью совместима с существующим кодом:

- Не требует изменений в других частях приложения
- Сохраняет обратную совместимость с существующими настройками
- Интегрируется с существующей системой смены тем
- Использует тот же формат QSettings

## Преимущества

1. **Централизованное управление**: Все настройки в одном месте
2. **Современный интерфейс**: Удобный диалог с прокруткой
3. **Валидация данных**: Проверка корректности введенных значений
4. **Горячие клавиши**: Быстрый доступ к функциям
5. **Сброс настроек**: Возможность восстановления значений по умолчанию
6. **Автоматическое применение**: Изменения применяются сразу

## Результат

Реализована полнофункциональная система настроек, которая:

- Предоставляет удобный интерфейс для управления настройками
- Интегрируется с существующей системой смены тем
- Перемещает выбор стиля из меню в диалог настроек
- Сохраняет все настройки между сессиями
- Обеспечивает валидацию и сброс настроек
