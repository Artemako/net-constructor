# Конфиги

Конфигурации хранятся в каталоге **configs/** в корне проекта (при сборке exe каталог копируется рядом с исполняемым файлом).

Загрузка и доступ — через класс `Configs` в [package.modules.configs](api/modules.md#package.modules.configs).

## Файлы

| Файл | Назначение |
|------|------------|
| **config_global.json** | Глобальные настройки отображения и параметры: секторы управления, узлы, соединения, типы диаграмм. Описывает структуру полей (название, тип, порядок, список для выбора и т.д.). |
| **config_nodes.json** | Типы узлов (оптическая муфта и др.): описание полей объекта, параметров переноса, обёрток. Ключи — идентификаторы типов (например `"0"`). |
| **config_connections.json** | Типы соединений (кабели и т.д.): поля объекта (марка ВОК, метки, параметры). Ключи — идентификаторы типов. |
| **config_lists.json** | Списки значений для выбора в UI: способы прокладки, марки кабелей, имена секторов и т.д. Структура: `lists` → тип списка → `items` (массив с `value`, `name`, `description`, `is_default`). При отсутствии или ошибке файла используется пустой объект `{"lists": {}}`. |

### Типы полей (значения ключа `type`)

В полях конфигов (`control_sectors_config`, `object_data`, `parameters`, `object_parameters`, `objects_parameters` и т.д.) ключ **type** задаёт вид виджета и формат значения.

Допустимые значения:

| Тип | Назначение / формат значения |
|-----|------------------------------|
| `string_line` | Однострочный текст. |
| `number_int` | Целое число ≥ 0 (при необходимости в параметрах диаграммы задаётся `arguments.min`). |
| `number_float` | Число с плавающей точкой. |
| `number_int_signed` | Целое число со знаком. |
| `list_with_custom` | Выбор из списка с возможностью своего значения; обязателен ключ `list_type` (ссылка на список из config_lists, например `sector_names`, `cable_types`). |
| `title` | Заголовок секции в форме настроек; поле не редактируется, используется для группировки. |
| `bool` | Логическое значение (в JSON часто 0/1 или 2 для трёх состояний Qt). |
| `color` | Цвет в формате `#RRGGBB`. |
| `fill_style` | Стиль заливки Qt (например `SolidPattern`, `DiagCrossPattern`); допустимые значения — в `package.constants.FillStyles`. |
| `line_style` | Стиль линии Qt (`SolidLine`, `DashLine` и т.д.); см. `package.constants.LineStyles`. |
| `font_name` | Строка шрифта в формате Qt (имя, размер и т.д.). |
| `text_align` | Выравнивание текста: `LeftAlign`, `CenterAlign`, `RightAlign`; см. `package.constants.TextAlignments`. |
| `physical_length_calculator` | Блок «оптическая/физическая длина»: значение — объект с ключами `од`, `к`, `фд` (оптическая длина, коэффициент, физическая длина). |

**Примечание:** В **config_lists.json** ключ `type` у каждого списка — это **идентификатор списка** (например `sector_names`, `cable_types`), а не тип поля. Он не входит в таблицу выше.

### config_global.json

Корневые ключи:

- **control_sectors_config** — описание полей секторов управления. Каждое поле — объект с ключами: `value`, `name`, `order`, при необходимости `type` (см. типы полей выше), `list_type` (для `list_with_custom`), `is_data`, `is_parameter`, `is_hide`.
- **diagrams** — типы диаграмм. Ключи — идентификаторы (`"0"`, `"50"`, `"100"`, `"150"` и т.д.). Для каждого: `order`, `type_id`, `name`, `id_nodes` (массив id узлов), `id_connections` (массив id соединений), `parameters` — параметры отображения диаграммы (отступы, расстояние между рядами, центрирование и т.д.). В каждом параметре: `value`, `name`, `order`, при необходимости `type` (см. типы полей выше).

**Соответствие ключей типов диаграмм и названий** (по полю `name` в конфиге):

| Ключ (type_id) | Название |
|----------------|----------|
| `"0"` | ПТ-3. Скелетная схема ВОЛП и основные данные цепей кабеля |
| `"50"` | ПТ-4. Схема размещения строительных длин и смонтированных муфт на участке между оконечными пунктами ВОЛП |
| `"100"` | ПТ-5. Скелетная схема размещения строительных длин кабеля и смонтированных муфт на участке регенерации |
| `"150"` | ПТ-13. Монтажная схема участка регенерации |

В коде тип диаграммы берётся из `diagram_type_id` в данных проекта. Отрисовка ветвится по `diagram_type_id` в [package.modules.drawnode](api/modules.md) (и при необходимости в других модулях рисования).

### config_nodes.json

Ключи верхнего уровня — идентификаторы типов узлов (`"0"`, `"1"`, …). Для каждого типа:

- **info** — краткое описание типа (например «Оптическая муфта»).
- **is_wrap** — флаг обёртки.
- **object_data** — данные объекта: поля с ключами `value`, `name`, `order`, при необходимости `type` (см. типы полей выше), `list_type`, `info`.
- **type_object_data**, **objects_data** — дополнительные данные (могут быть пустыми объектами).
- **object_parameters** — параметры экземпляра (перенос по X, соединение с тонкой линией и т.д.): `value`, `name`, `order`, при необходимости `type`.
- **type_object_parameters** — параметры типа (радиус вершины и т.д.).
- **objects_parameters** — общие параметры отображения (цвет рамки, заливка, шрифт названия и т.д.): `value`, `name`, `order`, при необходимости `type` (см. типы полей выше).

### config_connections.json

Структура аналогична config_nodes: ключи — идентификаторы типов соединений. Для каждого типа:

- **is_wrap**, **object_data**, **type_object_data**, **objects_data** — данные соединения (название/марка ВОК, метки, количество ОВ, оптическая и физическая длина, местоположение и т.д.). Поле может иметь `type` (см. типы полей выше) и `info` для подсказок.
- **object_parameters** — параметры экземпляра (длина соединения).
- **type_object_parameters**, **objects_parameters** — параметры отображения линии и подписей (цвет, толщина, стиль линии, шрифт подписей и т.д.; типы полей — см. выше).

### config_lists.json

- Корневой ключ **lists**. Внутри — типы списков (например `sector_names`, `cable_types`).
- Каждый список — объект с полями: **name**, **description**, **type**, **items** (массив элементов).
- Элемент **items**: **value** (значение), **name** (отображаемое имя), **description**, **is_default** (булев флаг значения по умолчанию).

При отсутствии или ошибке файла используется `{"lists": {}}`.

## Использование в коде

- **Загрузка**: при старте приложения `Configs.load_configs(dir_app)` читает все четыре файла из `dir_app/configs/`.
- **Сохранение**: списки сохраняются через `Configs.save_lists(dir_app)` в `config_lists.json`.
- **Доступ**: методы `get_list_by_type`, `get_list_config_by_type`, `update_list_by_type`; для обратной совместимости — `get_cable_list`, `update_cable_list`. Глобальные данные, узлы и соединения доступны через соответствующие геттеры класса `Configs`.

Не создавайте альтернативных мест чтения конфигов; пути к данным собирайте через `package.modules.dirpathmanager.DirPathManager`.
