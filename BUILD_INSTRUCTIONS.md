# Инструкции по сборке Net-Constructor

Этот документ содержит инструкции по сборке демо и полной версий программы с использованием защищенного параметра `is_demo`.

## Требования

- Python 3.8+
- PySide6
- Nuitka (для компиляции)

Установка Nuitka:
```bash
pip install nuitka
```

## Сборка демо-версии

Для создания демо-версии программы:

```bash
python build_demo.py
```

Результат будет в папке `build_demo/`.

### Характеристики демо-версии:
- Автоматически открывается встроенный демо-проект
- Блокировка создания новых проектов
- Блокировка сохранения проектов
- Блокировка экспорта в PNG
- Водяные знаки "DEMO SAMPLE" на диаграмме
- Индикатор "ДЕМО-ВЕРСИЯ" в заголовке окна и статус-баре

## Сборка полной версии

Для создания полной версии программы:

```bash
python build_full.py
```

Результат будет в папке `build_full/`.

### Характеристики полной версии:
- Все функции доступны
- Нет водяных знаков
- Нет ограничений на сохранение и экспорт

## Как это работает

### Система защиты

Защита основана на многоуровневой верификации:

1. **Секретный ключ**: Каждая версия (демо/полная) имеет уникальный секретный ключ, встраиваемый в код при компиляции

2. **HMAC-токены**: Генерируются токены на основе секретного ключа с использованием HMAC-SHA256

3. **Обфускация**: Дополнительное вычисление на основе математических операций с секретным ключом

4. **Проверка во время выполнения**: Модуль `license.py` выполняет множественные проверки для определения режима работы

### Процесс сборки

1. Скрипт `build_demo.py` или `build_full.py` генерирует уникальные токены
2. Создается резервная копия `package/modules/license.py`
3. Плейсхолдеры `{{BUILD_SECRET_KEY}}`, `{{DEMO_TOKEN}}` и т.д. заменяются на реальные значения
4. Запускается компиляция с Nuitka
5. После сборки восстанавливается оригинальный `license.py` из backup

### Безопасность

- Секретные ключи НЕ хранятся в репозитории в открытом виде
- Каждая версия имеет свой уникальный ключ
- Токены вычисляются динамически при сборке
- Nuitka компилирует Python в C, что усложняет декомпиляцию

## ВАЖНО: Безопасность

### НЕ коммитьте в публичный репозиторий:
- `build_demo.py` с реальными ключами
- `build_full.py` с реальными ключами
- Файлы из папок `build_demo/` и `build_full/`
- Резервные копии `*.backup`

### Рекомендации:
1. Храните секретные ключи в безопасном месте
2. Используйте разные ключи для каждой версии
3. Меняйте ключи для каждого major release
4. Не храните скрипты сборки с реальными ключами в публичных репозиториях

### Для безопасного хранения ключей:

Вариант 1: Использовать переменные окружения
```python
import os
SECRET_KEY = os.environ.get('BUILD_SECRET_KEY', 'default_key_for_dev')
```

Вариант 2: Использовать отдельный конфиг-файл (не в репозитории)
```python
from build_config import SECRET_KEY
```

Добавьте в `.gitignore`:
```
build_config.py
build_demo/
build_full/
*.backup
```

## Тестирование

После сборки обязательно протестируйте обе версии:

### Демо-версия должна:
- [ ] Автоматически открыть демо-проект при запуске
- [ ] Показывать "ДЕМО-ВЕРСИЯ" в заголовке
- [ ] Показывать баннер в статус-баре
- [ ] Блокировать создание новых файлов (кнопка неактивна)
- [ ] Блокировать сохранение (кнопка неактивна)
- [ ] Блокировать экспорт в PNG (кнопка неактивна)
- [ ] Показывать водяные знаки "DEMO SAMPLE" на диаграмме

### Полная версия должна:
- [ ] Запускаться без демо-проекта
- [ ] НЕ показывать "ДЕМО-ВЕРСИЯ"
- [ ] НЕ показывать баннер в статус-баре
- [ ] Разрешать создание новых файлов
- [ ] Разрешать сохранение
- [ ] Разрешать экспорт в PNG
- [ ] НЕ показывать водяные знаки

## Устранение проблем

### Ошибка: Nuitka not found
```bash
pip install nuitka
```

### Ошибка: PySide6 plugin not found
```bash
pip install pyside6
```

### Ошибка компиляции
Проверьте логи Nuitka в выводе команды. Убедитесь что:
- Все зависимости установлены
- Путь к файлам корректен
- Нет синтаксических ошибок в коде

### Программа не запускается
1. Проверьте, что все DLL файлы PySide6 скопированы в папку сборки
2. Запустите из командной строки чтобы увидеть ошибки
3. Проверьте логи Nuitka

## Дополнительная информация

Для более продвинутых опций Nuitka смотрите официальную документацию:
https://nuitka.net/doc/user-manual.html

## Оценка времени на взлом

При правильной реализации взлом защиты потребует:
- Декомпиляции C-кода из Nuitka
- Нахождения всех точек проверки в коде
- Генерации правильных HMAC-токенов
- Модификации множества мест в коде

**Примерное время для опытного реверс-инженера: 40-80 часов**

Это делает взлом нерентабельным для большинства случаев использования демо-версии.
